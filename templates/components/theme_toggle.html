<div class="theme-toggle">
  <form id="theme-form">
    <div class="theme-options">
      <label class="theme-option" title="Follow system preference">
        <input 
          type="radio" 
          name="theme" 
          value="auto" 
          {% if current_theme == "auto" %}checked{% endif %}
        />
        <span class="theme-icon">🌓</span>
      </label>
      
      <label class="theme-option" title="Always use light theme">
        <input 
          type="radio" 
          name="theme" 
          value="light" 
          {% if current_theme == "light" %}checked{% endif %}
        />
        <span class="theme-icon">☀️</span>
      </label>
      
      <label class="theme-option" title="Always use dark theme">
        <input 
          type="radio" 
          name="theme" 
          value="dark" 
          {% if current_theme == "dark" %}checked{% endif %}
        />
        <span class="theme-icon">🌙</span>
      </label>
    </div>
  </form>
</div>

<script>
  // Apply theme immediately when changed and save to server
  document.querySelectorAll('input[name="theme"]').forEach(input => {
    input.addEventListener('change', function() {
      const theme = this.value;
      
      // Apply theme immediately using the global function
      if (window.applyTheme) {
        window.applyTheme(theme);
      }
      
      // Save preference to server
      const params = new URLSearchParams();
      params.append('theme', theme);
      
      fetch('/api/settings/theme', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: params
      }).catch(err => {
        console.error('Failed to save theme preference:', err);
      });
    });
  });
</script>